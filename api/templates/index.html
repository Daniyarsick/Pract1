<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wine Quality Prediction API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .feature-input {
            margin-bottom: 15px;
        }
        .prediction-result {
            margin-top: 20px;
        }
        .navbar-brand {
            font-weight: bold;
        }
        .card {
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
        <div class="container">
            <a class="navbar-brand" href="#">üç∑ Wine Quality Prediction</a>
        </div>
    </nav>

    <div class="container mt-5">
        <div class="row">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-header">
                        <h3>–ü—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –≤–∏–Ω–∞</h3>
                        <p class="mb-0">–í–≤–µ–¥–∏—Ç–µ —Ö–∏–º–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤–∏–Ω–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞</p>
                    </div>
                    <div class="card-body">
                        <form id="prediction-form">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="feature-input">
                                        <label for="fixed_acidity" class="form-label">–§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å (g/L)</label>
                                        <input type="number" class="form-control" id="fixed_acidity" step="0.1" value="7.0" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="volatile_acidity" class="form-label">–õ–µ—Ç—É—á–∞—è –∫–∏—Å–ª–æ—Ç–Ω–æ—Å—Ç—å (g/L)</label>
                                        <input type="number" class="form-control" id="volatile_acidity" step="0.01" value="0.3" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="citric_acid" class="form-label">–õ–∏–º–æ–Ω–Ω–∞—è –∫–∏—Å–ª–æ—Ç–∞ (g/L)</label>
                                        <input type="number" class="form-control" id="citric_acid" step="0.01" value="0.3" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="residual_sugar" class="form-label">–û—Å—Ç–∞—Ç–æ—á–Ω—ã–π —Å–∞—Ö–∞—Ä (g/L)</label>
                                        <input type="number" class="form-control" id="residual_sugar" step="0.1" value="2.0" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="chlorides" class="form-label">–•–ª–æ—Ä–∏–¥—ã (g/L)</label>
                                        <input type="number" class="form-control" id="chlorides" step="0.001" value="0.08" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="free_sulfur_dioxide" class="form-label">–°–≤–æ–±–æ–¥–Ω—ã–π SO2 (mg/L)</label>
                                        <input type="number" class="form-control" id="free_sulfur_dioxide" step="1" value="15" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="feature-input">
                                        <label for="total_sulfur_dioxide" class="form-label">–û–±—â–∏–π SO2 (mg/L)</label>
                                        <input type="number" class="form-control" id="total_sulfur_dioxide" step="1" value="45" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="density" class="form-label">–ü–ª–æ—Ç–Ω–æ—Å—Ç—å (g/mL)</label>
                                        <input type="number" class="form-control" id="density" step="0.0001" value="0.996" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="pH" class="form-label">–£—Ä–æ–≤–µ–Ω—å pH</label>
                                        <input type="number" class="form-control" id="pH" step="0.01" value="3.3" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="sulphates" class="form-label">–°—É–ª—å—Ñ–∞—Ç—ã (g/L)</label>
                                        <input type="number" class="form-control" id="sulphates" step="0.01" value="0.6" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="alcohol" class="form-label">–°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ –∞–ª–∫–æ–≥–æ–ª—è (%)</label>
                                        <input type="number" class="form-control" id="alcohol" step="0.1" value="10.0" required>
                                    </div>
                                    <div class="feature-input">
                                        <label for="wine_type" class="form-label">–¢–∏–ø –≤–∏–Ω–∞</label>
                                        <select class="form-select" id="wine_type" required>
                                            <option value="0">–ë–µ–ª–æ–µ –≤–∏–Ω–æ</option>
                                            <option value="1">–ö—Ä–∞—Å–Ω–æ–µ –≤–∏–Ω–æ</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="text-center">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <span class="spinner-border spinner-border-sm d-none" id="loading-spinner"></span>
                                    –ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
            
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header">
                        <h5>–†–µ–∑—É–ª—å—Ç–∞—Ç –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏—è</h5>
                    </div>
                    <div class="card-body">
                        <div id="result-container" class="text-center">
                            <p class="text-muted">–ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü—Ä–µ–¥—Å–∫–∞–∑–∞—Ç—å –∫–∞—á–µ—Å—Ç–≤–æ"</p>
                        </div>
                        <canvas id="probability-chart" width="300" height="300" style="display: none;"></canvas>
                    </div>
                </div>
                
                <div class="card mt-3">
                    <div class="card-header">
                        <h6>API Endpoints</h6>
                    </div>
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li><code>POST /api/predict</code> - –û–¥–∏–Ω–æ—á–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</li>
                            <li><code>POST /api/predict/batch</code> - –ü–∞–∫–µ—Ç–Ω–æ–µ –ø—Ä–µ–¥—Å–∫–∞–∑–∞–Ω–∏–µ</li>
                            <li><code>GET /api/features</code> - –°–ø–∏—Å–æ–∫ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤</li>
                            <li><code>GET /api/health</code> - –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–∞</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let probabilityChart = null;

        document.getElementById('prediction-form').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = e.target.querySelector('button[type="submit"]');
            const spinner = document.getElementById('loading-spinner');
            const resultContainer = document.getElementById('result-container');
            
            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
            spinner.classList.remove('d-none');
            submitButton.disabled = true;
            
            try {
                // –°–æ–±–∏—Ä–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ñ–æ—Ä–º—ã
                const formData = {
                    fixed_acidity: parseFloat(document.getElementById('fixed_acidity').value),
                    volatile_acidity: parseFloat(document.getElementById('volatile_acidity').value),
                    citric_acid: parseFloat(document.getElementById('citric_acid').value),
                    residual_sugar: parseFloat(document.getElementById('residual_sugar').value),
                    chlorides: parseFloat(document.getElementById('chlorides').value),
                    free_sulfur_dioxide: parseFloat(document.getElementById('free_sulfur_dioxide').value),
                    total_sulfur_dioxide: parseFloat(document.getElementById('total_sulfur_dioxide').value),
                    density: parseFloat(document.getElementById('density').value),
                    pH: parseFloat(document.getElementById('pH').value),
                    sulphates: parseFloat(document.getElementById('sulphates').value),
                    alcohol: parseFloat(document.getElementById('alcohol').value),
                    wine_type_red: parseInt(document.getElementById('wine_type').value)
                };
                
                // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                const response = await fetch('/api/predict', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    displayResult(result);
                } else {
                    displayError(result.error || '–û—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –∑–∞–ø—Ä–æ—Å–∞');
                }
                
            } catch (error) {
                displayError('–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ' + error.message);
            } finally {
                // –°–∫—Ä—ã–≤–∞–µ–º –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                spinner.classList.add('d-none');
                submitButton.disabled = false;
            }
        });
        
        function displayResult(result) {
            const container = document.getElementById('result-container');
            const qualityText = getQualityText(result.prediction);
            const confidencePercent = (result.confidence * 100).toFixed(1);
            
            container.innerHTML = `
                <div class="alert alert-success">
                    <h4>–ö–∞—á–µ—Å—Ç–≤–æ –≤–∏–Ω–∞: ${result.prediction}</h4>
                    <p class="mb-2">${qualityText}</p>
                    <small>–£–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: ${confidencePercent}%</small>
                </div>
            `;
            
            // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≥—Ä–∞—Ñ–∏–∫ –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–µ–π
            displayProbabilityChart(result.probabilities);
        }
        
        function displayError(error) {
            const container = document.getElementById('result-container');
            container.innerHTML = `
                <div class="alert alert-danger">
                    <h6>–û—à–∏–±–∫–∞</h6>
                    <p class="mb-0">${error}</p>
                </div>
            `;
            
            // –°–∫—Ä—ã–≤–∞–µ–º –≥—Ä–∞—Ñ–∏–∫
            document.getElementById('probability-chart').style.display = 'none';
        }
        
        function getQualityText(quality) {
            const descriptions = {
                3: '–û—á–µ–Ω—å –Ω–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ',
                4: '–ù–∏–∑–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ',
                5: '–°—Ä–µ–¥–Ω–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ',
                6: '–•–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ',
                7: '–û—á–µ–Ω—å —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ',
                8: '–û—Ç–ª–∏—á–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ',
                9: '–ü—Ä–µ–≤–æ—Å—Ö–æ–¥–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ'
            };
            return descriptions[quality] || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ';
        }
        
        function displayProbabilityChart(probabilities) {
            const canvas = document.getElementById('probability-chart');
            const ctx = canvas.getContext('2d');
            
            // –£–Ω–∏—á—Ç–æ–∂–∞–µ–º –ø—Ä–µ–¥—ã–¥—É—â–∏–π –≥—Ä–∞—Ñ–∏–∫
            if (probabilityChart) {
                probabilityChart.destroy();
            }
            
            const labels = Object.keys(probabilities).sort();
            const data = labels.map(label => probabilities[label] * 100);
            
            probabilityChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å (%)',
                        data: data,
                        backgroundColor: 'rgba(54, 162, 235, 0.6)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        title: {
                            display: true,
                            text: '–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–∏ –ø–æ –∫–ª–∞—Å—Å–∞–º –∫–∞—á–µ—Å—Ç–≤–∞'
                        }
                    }
                }
            });
            
            canvas.style.display = 'block';
        }
    </script>
</body>
</html>
